<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 9 Science Portal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        .container {
            max-width: 1000px;
        }
        .card {
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        .header {
            background-color: #0d47a1;
            color: white;
        }
        .subject-button {
            transition: all 0.3s ease;
        }
        .subject-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pt-10">

    <div id="app" class="container mx-auto p-4">

        <!-- Header -->
        <header class="header p-6 mb-8 rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold text-center">Class 9 Science Portal</h1>
            <p class="text-center text-blue-200 mt-2">Choose a subject to begin your revision.</p>
        </header>

        <!-- Main Content Area -->
        <div id="content-area" class="card p-6">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Subjects</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Physics -->
                <a href="science/physics/gravitation_quiz.html" class="subject-button flex flex-col items-center justify-center p-6 bg-blue-100 text-blue-800 rounded-xl hover:bg-blue-200">
                    <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l-3 3-3-3m9 16V6l3 3 3-3"></path></svg>
                    <span class="text-xl font-semibold">Physics</span>
                </a>
                
                <!-- Chemistry (Placeholder Link) -->
                <a href="#" class="subject-button flex flex-col items-center justify-center p-6 bg-green-100 text-green-800 rounded-xl hover:bg-green-200 opacity-50 cursor-not-allowed" onclick="return false;">
                    <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343h7a2 2 0 012 2v4a2 2 0 01-2 2h-2.343"></path></svg>
                    <span class="text-xl font-semibold">Chemistry (Coming Soon)</span>
                </a>

                <!-- Biology (Placeholder Link) -->
                <a href="#" class="subject-button flex flex-col items-center justify-center p-6 bg-pink-100 text-pink-800 rounded-xl hover:bg-pink-200 opacity-50 cursor-not-allowed" onclick="return false;">
                    <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.5v15m0-15l6.5 6.5M12 4.5L5.5 11M3 15h18"></path></svg>
                    <span class="text-xl font-semibold">Biology (Coming Soon)</span>
                </a>
            </div>
        </div>

        <!-- Admin Utilities for Data Setup -->
        <div class="mt-8 p-4 bg-yellow-100 rounded-xl border border-yellow-300">
            <p class="text-sm font-semibold text-yellow-800 mb-2">Admin Utilities (For Initial Setup)</p>
            <button id="adminSetupBtn" 
                    class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-150"
                    onclick="addGravitationQuizData()">
                <span id="setupBtnText">1-Click Setup: Add Gravitation Quiz Data</span>
            </button>
            <p id="authStatus" class="text-xs mt-2 text-yellow-700">Auth Status: Loading...</p>
        </div>
    </div>

    <!-- Firebase Initialization and Global Exposure -->
    <script>
        // CRITICAL: Expose global variables if they are available in the Canvas environment
        window.firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        window.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        window.initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Set a global flag for authentication readiness
        window.isAuthReady = false;
        window.db = null; // Firestore instance
        window.auth = null; // Auth instance
        window.userId = null;
    </script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, query, collection, onSnapshot, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 1. Global Exposure of Key Functions ---
        // CRITICAL FIX: Attach required Firestore functions to the global window object for console access
        window.doc = doc;
        window.setDoc = setDoc;
        window.query = query;
        window.collection = collection;
        window.onSnapshot = onSnapshot;
        window.getDoc = getDoc;


        // --- 2. Initialization and Authentication ---
        if (window.firebaseConfig) {
            setLogLevel('debug');
            try {
                const app = initializeApp(window.firebaseConfig);
                window.db = getFirestore(app);
                window.auth = getAuth(app);

                // Wait for auth state to be resolved
                onAuthStateChanged(window.auth, async (user) => {
                    if (user) {
                        window.userId = user.uid;
                        document.getElementById('authStatus').textContent = `Auth Status: Logged in (User ID: ${user.uid})`;
                    } else {
                        // Attempt to sign in using the custom token provided by the environment
                        if (window.initialAuthToken) {
                            await signInWithCustomToken(window.auth, window.initialAuthToken);
                        } else {
                            // If no custom token, sign in anonymously
                            await signInAnonymously(window.auth);
                        }
                    }
                    window.isAuthReady = true;
                    console.log('Firebase Auth Ready. User ID:', window.userId);

                    // Re-enable admin button if auth is ready
                    document.getElementById('adminSetupBtn').disabled = false;
                    document.getElementById('setupBtnText').textContent = '1-Click Setup: Add Gravitation Quiz Data';

                });

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                document.getElementById('authStatus').textContent = `Auth Status: ERROR (${error.message})`;
            }
        } else {
            document.getElementById('authStatus').textContent = "Auth Status: ERROR (__firebase_config not found).";
        }
    </script>

    <!-- Data Setup Script (Now uses globally exposed functions) -->
    <script>
        /**
         * Adds a placeholder quiz document for 'quiz_gravitation' to Firestore.
         * This function relies on window.db, window.setDoc, window.doc, and window.appId 
         * being exposed by the Firebase initialization module above.
         */
        async function addGravitationQuizData() {
            document.getElementById('setupBtnText').textContent = 'Writing to Firestore...';
            document.getElementById('adminSetupBtn').disabled = true;

            // CRITICAL: Ensure the global Firebase objects are available
            if (!window.db || !window.isAuthReady) {
                console.error("FATAL: Firebase is not initialized or authenticated. Cannot proceed.");
                alert("Setup Failed: Firebase service not ready. Check console.");
                document.getElementById('setupBtnText').textContent = 'Service Not Ready';
                document.getElementById('adminSetupBtn').disabled = false;
                return;
            }

            const db = window.db;
            const appId = window.appId;
            const setDoc = window.setDoc;
            const doc = window.doc;
            
            const chapterId = 'quiz_gravitation';
            // Path: /artifacts/{appId}/public/data/quizzes/quiz_gravitation
            const quizPath = `artifacts/${appId}/public/data/quizzes`;
            
            const quizData = {
                simple: [
                    { question: "What is the force of attraction between any two objects in the universe?", options: ["Friction", "Tension", "Gravitation", "Magnetism"], correctAnswerIndex: 2 },
                    { question: "What is the unit of force in the SI system?", options: ["Joule", "Watt", "Newton", "Pascal"], correctAnswerIndex: 2 }
                ],
                medium: [
                    { question: "The value of acceleration due to gravity (g) is maximum at the:", options: ["Equator", "Center of the Earth", "Poles", "All points are equal"], correctAnswerIndex: 2 },
                    { question: "What happens to the weight of an object when it is taken to the Moon?", options: ["Increases", "Decreases", "Stays the same", "Becomes zero"], correctAnswerIndex: 1 }
                ],
                advance: [
                    { question: "The weight of an object is 60 N on the Earth. What would be its mass on the Moon? (Take g = 10 m/sÂ² on Earth)", options: ["6 kg", "10 kg", "60 kg", "360 N"], correctAnswerIndex: 0 },
                    { question: "According to Kepler's law of areas, the line joining the planet and the Sun sweeps equal areas in equal intervals of time. This law is a consequence of the conservation of:", options: ["Linear Momentum", "Energy", "Angular Momentum", "Kinetic Energy"], correctAnswerIndex: 2 }
                ]
            };

            try {
                const quizRef = doc(db, quizPath, chapterId);
                await setDoc(quizRef, quizData);
                
                console.log(`SUCCESS: Document '${chapterId}' created successfully at path: ${quizPath}.`);
                document.getElementById('setupBtnText').textContent = 'SUCCESS! Data Uploaded.';
                document.getElementById('adminSetupBtn').disabled = false;
                
                alert(`SUCCESS: Quiz data for Gravitation has been created in Firestore. Please reload the quiz page (e.g., gravitation_quiz.html) to test!`);
                
            } catch (error) {
                console.error("ERROR: Failed to add quiz data.", error);
                document.getElementById('setupBtnText').textContent = 'ERROR (Check Console)';
                document.getElementById('adminSetupBtn').disabled = false;
                alert("ERROR: Failed to add quiz data. The original error is logged to the console.");
            }
        }
    </script>
</body>
</html>
