name: 🧩 Create New Quiz Chapter File

on:
  workflow_dispatch:
    inputs:
      chapter_title:
        description: 'Quiz Title (e.g., Work and Energy Quiz)'
        required: true
        type: string
      supabase_table:
        description: 'Supabase Table Name (e.g., work_energy)'
        required: true
        type: string
      # Renaming this input internally to be clear about its purpose (filename)
      output_filename:
        description: 'Target HTML Filename (e.g., work_quiz.html)'
        required: true
        type: string

jobs:
  create_file:
    runs-on: ubuntu-latest
    
    # Grants the necessary write access for the commit action (403 fix)
    permissions:
      contents: write
    
    steps:
      - name: 🛎️ Checkout code
        uses: actions/checkout@v4

      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: 🚀 Run Quiz Creation Script
        id: run_script
        run: |
          # Pass the arguments using the names the Python script EXPECTS (--title, --table, --output)
          python scripts/create_quiz.py \
            --title "${{ github.event.inputs.chapter_title }}" \
            --table "${{ github.event.inputs.supabase_table }}" \
            --output "${{ github.event.inputs.output_filename }}"  # <--- FIXED ARGUMENT NAME

      - name: 💾 Commit new quiz file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🤖 Feat: Add new quiz page for ${{ github.event.inputs.chapter_title }}"
          # The committed file path must match the expected output location of the Python script
          file_pattern: "science/physics/${{ github.event.inputs.output_filename }}"
