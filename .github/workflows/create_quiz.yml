name: ğŸ§© Create New Quiz Chapter File

on:
  workflow_dispatch:
    inputs:
      chapter_title:
        description: 'Quiz Title (e.g., Work and Energy Quiz)'
        required: true
        type: string
      supabase_table:
        description: 'Supabase Table Name (e.g., work_energy)'
        required: true
        type: string
      output_filename:
        description: 'Target HTML Filename (e.g., work_quiz.html)'
        required: true
        type: string

jobs:
  create_file:
    runs-on: ubuntu-latest
    
    # This is the fix for the 403 Forbidden error
    permissions:
      contents: write
    
    steps:
      - name: ğŸ›ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸš€ Run Quiz Creation Script
        id: run_script
        run: |
          # The Python script MUST use the output path relative to the repository root.
          # We force the output path to include the correct subdirectory.
          # For example: --output "science/physics/work_quiz.html"
          python scripts/create_quiz.py \
            --title "${{ github.event.inputs.chapter_title }}" \
            --table "${{ github.event.inputs.supabase_table }}" \
            --output "science/physics/${{ github.event.inputs.output_filename }}" 

      - name: ğŸ’¾ Commit new quiz file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Feat: Add new quiz page for ${{ github.event.inputs.chapter_title }}"
          # The file pattern is correct IF the python script outputs to this location.
          file_pattern: "science/physics/${{ github.event.inputs.output_filename }}" 
