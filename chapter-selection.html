<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Select Chapter & Difficulty</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        'cbse-blue': '#1a3e6a', 
                        'cbse-light': '#f5f7fa',
                        'accent-gold': '#ffb703',
                        'heading': '#0f172a',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .cbse-blue { background-color: #1a3e6a; }
        .cbse-light { background-color: #f5f7fa; }
        .header-bg { background-color: #1a3e6a; } /* Using cbse-blue for consistency */
        .card { @apply bg-white p-6 rounded-xl shadow-lg transition-transform duration-300 hover:shadow-xl; }
        .chapter-card { cursor: pointer; }
        .chapter-card:hover { transform: translateY(-3px); }
        .selected-chapter { @apply border-4 border-blue-500 ring-2 ring-blue-500; }
        .selected-difficulty { @apply bg-blue-600 text-white shadow-md; }

        /* Custom style for difficulty buttons to ensure pointer events pass through to the button itself */
        .difficulty-btn > * {
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-cbse-light min-h-screen flex flex-col">

    <!-- HEADER (Copied from index.html) -->
    <header class="header-bg bg-cbse-blue shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-extrabold text-white tracking-tight">
                Ready4Exam
            </h1>
            <!-- Placeholder for Auth/Logout Button -->
            <a href="quiz-engine.html" class="hidden text-sm py-2 px-4 rounded-full bg-accent-gold text-cbse-blue font-semibold transition hover:bg-yellow-400">
                Practice Now
            </a>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex-grow mt-10">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-extrabold text-heading" id="page-title">
                Select Chapter & Difficulty
            </h1>
            <p class="text-lg text-gray-600 mt-2">Choose a chapter and quiz difficulty to begin your practice session.</p>
        </div>

        <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl">
            <!-- 1. Chapter Selection -->
            <h2 class="text-2xl font-bold text-cbse-blue mb-4 flex items-center">
                <i data-lucide="list-checks" class="w-6 h-6 mr-3"></i> 
                1. Choose a Chapter
            </h2>
            <div id="chapter-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-10">
                <!-- Chapter cards will be rendered here by JavaScript -->
                <p class="text-center text-gray-500 col-span-full">Loading chapters...</p>
            </div>

            <!-- 2. Difficulty Selection -->
            <h2 class="text-2xl font-bold text-cbse-blue mb-4 flex items-center">
                <i data-lucide="bar-chart-3" class="w-6 h-6 mr-3"></i> 
                2. Select Difficulty
            </h2>
            <div id="difficulty-selection" class="flex flex-col sm:flex-row gap-4 mb-8">
                <!-- Easy -->
                <button data-difficulty="easy" class="difficulty-btn card text-left flex-1 p-4 border-2 border-green-500 bg-green-50 hover:bg-green-100">
                    <p class="font-bold flex items-center text-green-700"><i data-lucide="trending-down" class="w-5 h-5 mr-2"></i> Easy</p>
                    <p class="text-sm text-gray-600 mt-1">Focus on definitions and basic concepts. Great for revision.</p>
                </button>
                <!-- Medium (Pre-selected) -->
                <button data-difficulty="medium" class="difficulty-btn card text-left flex-1 p-4 border-2 border-yellow-500 bg-yellow-50 hover:bg-yellow-100">
                    <p class="font-bold flex items-center text-yellow-700"><i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Medium</p>
                    <p class="text-sm text-gray-600 mt-1">Standard questions covering moderate application and problem-solving.</p>
                </button>
                <!-- Advanced -->
                <button data-difficulty="advanced" class="difficulty-btn card text-left flex-1 p-4 border-2 border-red-500 bg-red-50 hover:bg-red-100">
                    <p class="font-bold flex items-center text-red-700"><i data-lucide="zap" class="w-5 h-5 mr-2"></i> Advanced</p>
                    <p class="text-sm text-gray-600 mt-1">Challenging questions including Assertion-Reasoning and Case Studies.</p>
                </button>
            </div>

            <!-- 3. Start Quiz Button -->
            <div class="text-center">
                <p id="error-message" class="text-red-500 mb-4 font-semibold hidden">
                    Please select both a **Chapter** and a **Difficulty** level to begin.
                </p>
                <button id="start-quiz-btn" class="px-10 py-4 bg-cbse-blue text-white text-xl font-bold rounded-xl shadow-lg hover:bg-blue-700 transition transform hover:scale-105">
                    Start Quiz Session
                </button>
            </div>
        </div>
    </main>

    <!-- FOOTER (Copied from index.html) -->
    <footer class="bg-cbse-blue mt-16 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white">
            <small class="text-sm opacity-70 block mt-2">Â© 2025 Ready4Exam Academic Portal. All Rights Reserved.</small>
        </div>
    </footer>
    
    <script>
        // --- MOCK DATA ---
        // This is the source of all the chapter content displayed on the page.
        const MOCK_CHAPTERS = {
            'Science': [
                { name: '1. Matter in Our Surroundings', slug: 'matter_in_our_surroundings' },
                { name: '2. Is Matter Around Us Pure', slug: 'is_matter_around_us_pure' },
                { name: '5. The Fundamental Unit of Life', slug: 'fundamental_unit_of_life' },
                { name: '6. Tissues', slug: 'tissues' },
                { name: '8. Motion', slug: 'motion' },
                { name: '9. Force and Laws of Motion', slug: 'force_and_laws_of_motion' },
                { name: '10. Gravitation', slug: 'gravitation' },
            ],
            'Social_Science': [
                { name: '1. The French Revolution (History)', slug: 'french_revolution' },
                { name: '2. Socialism in Europe and the Russian Revolution (History)', slug: 'russian_revolution' },
                { name: '1. Democracy in the Contemporary World (Civics)', slug: 'democracy_contemporary' },
                { name: '2. Constitutional Design (Civics)', slug: 'constitutional_design' },
                { name: '1. India - Size and Location (Geography)', slug: 'india_size_location' },
                { name: '1. The Story of Village Palampur (Economics)', slug: 'village_palampur' },
            ],
            'Mathematics': [
                { name: '1. Number Systems', slug: 'number_systems' },
                { name: '2. Polynomials', slug: 'polynomials' },
                { name: '3. Coordinate Geometry', slug: 'coordinate_geometry' },
                { name: '6. Lines and Angles', slug: 'lines_and_angles' },
                { name: '7. Triangles', slug: 'triangles' },
                { name: '12. Heron\'s Formula', slug: 'herons_formula' },
                { name: '13. Surface Areas and Volumes', slug: 'surface_areas_and_volumes' },
            ]
        };

        // --- STATE & ELEMENTS ---
        let selectedTopic = null;
        let selectedDifficulty = null;
        const chapterListEl = document.getElementById('chapter-list');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const errorMessageEl = document.getElementById('error-message');
        const difficultySelectionEl = document.getElementById('difficulty-selection');
        const pageTitleEl = document.getElementById('page-title'); 

        // --- HANDLERS ---
        function handleChapterSelection(topicSlug, cardElement) {
            selectedTopic = topicSlug;
            // Remove selection class from all cards
            document.querySelectorAll('.chapter-card').forEach(card => {
                card.classList.remove('selected-chapter');
                card.classList.add('border-transparent');
            });
            // Add selection class to the clicked card
            cardElement.classList.add('selected-chapter');
            cardElement.classList.remove('border-transparent');
            // Hide error message on successful selection
            errorMessageEl.classList.add('hidden');
        }

        function handleDifficultySelection(difficulty, buttonElement) {
            selectedDifficulty = difficulty;
            // Remove selection class from all difficulty buttons
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected-difficulty');
            });
            // Add selection class to the clicked button
            buttonElement.classList.add('selected-difficulty');
            errorMessageEl.classList.add('hidden');
        }

        function renderChapters() {
            const params = new URLSearchParams(window.location.search);
            const subject = params.get('subject') || 'Science'; // Default to Science if no param is set
            const subjectTitle = subject.replace(/_/g, ' '); // Replace underscores for display
            
            // Set the page title
            pageTitleEl.textContent = `${subjectTitle} Chapters (Class 9)`;

            const chapters = MOCK_CHAPTERS[subject] || [];

            if (chapters.length === 0) {
                chapterListEl.innerHTML = `<p class="text-xl text-red-500 col-span-full text-center">No chapters found for ${subjectTitle}.</p>`;
                return;
            }

            chapterListEl.innerHTML = ''; // Clear previous content

            chapters.forEach(chapter => {
                const chapterName = chapter.name;
                const chapterSlug = chapter.slug;
                
                // Create the chapter card element
                const card = document.createElement('div');
                // Updated classes for better visual feedback
                card.className = 'chapter-card card cursor-pointer bg-white p-6 rounded-xl shadow-md transition-transform duration-200 hover:shadow-xl hover:translate-y-[-3px] border-2 border-transparent';
                card.dataset.topic = chapterSlug;
                card.innerHTML = `
                    <p class="text-sm font-semibold text-gray-500 mb-1">Chapter</p>
                    <h4 class="text-lg font-bold text-gray-800">${chapterName}</h4>
                    <p class="text-sm text-blue-600 mt-2 flex items-center">
                        Select to start quiz <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                    </p>
                `;

                // Set up the click handler
                card.addEventListener('click', () => handleChapterSelection(chapterSlug, card));

                chapterListEl.appendChild(card);
            });
            
            // Re-create lucide icons after injecting HTML
            lucide.createIcons(); 
        }

        function handleStartQuiz() {
            if (selectedTopic && selectedDifficulty) {
                // Ensure we get the subject again for the URL, defaulting to 'Science'
                const subject = new URLSearchParams(window.location.search).get('subject') || 'Science';
                // Pass the necessary parameters to the quiz engine
                const url = `quiz-engine.html?class=9&subject=${subject}&topic=${selectedTopic}&difficulty=${selectedDifficulty}`;
                window.location.href = url;
            } else {
                errorMessageEl.classList.remove('hidden');
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderChapters();
            
            // Attach event listeners to difficulty buttons
            difficultySelectionEl.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const clickedButton = e.currentTarget; 
                    handleDifficultySelection(clickedButton.dataset.difficulty, clickedButton);
                });
            });

            startQuizBtn.addEventListener('click', handleStartQuiz);

            // Pre-select the 'medium' difficulty button on load
            // This ensures a default difficulty is always set.
            document.querySelector('.difficulty-btn[data-difficulty="medium"]').click();
        });
    </script>
</body>
</html>
