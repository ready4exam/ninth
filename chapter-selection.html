<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Select Chapter & Difficulty</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .cbse-blue { background-color: #1a3e6a; }
        .cbse-light { background-color: #f5f7fa; }
        .header-bg { background-color: #0d47a1; }
        .card { @apply bg-white p-6 rounded-xl shadow-lg transition-transform duration-300 hover:shadow-xl; }
        .chapter-card { cursor: pointer; }
        .chapter-card:hover { transform: translateY(-3px); }
        .selected-chapter { @apply border-4 border-blue-500 ring-2 ring-blue-500; }
        .selected-difficulty { @apply bg-blue-600 text-white shadow-md; }

        /* Custom style for difficulty buttons to ensure pointer events pass through to the button itself */
        .difficulty-btn > * {
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-cbse-light min-h-screen">
    
    <!-- BRANDING HEADER -->
    <header class="header-bg p-4 shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-2xl font-extrabold text-white">
                Ready4Exam
            </h1>
            <p class="text-sm text-blue-200">Select your learning path.</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h2 id="page-title" class="text-3xl font-extrabold text-heading mb-6">Select a Chapter and Difficulty</h2>
        <p class="text-gray-600 mb-8">Choose a chapter and the level of questions you want to practice to begin your quiz.</p>

        <!-- Chapter Selection -->
        <section class="mb-10">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-lucide="book-open" class="h-6 w-6 mr-3 text-blue-500"></i>
                Chapters
            </h3>
            <div id="chapter-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Chapter cards will be rendered here by JavaScript -->
                <div class="card chapter-card flex flex-col justify-between" data-topic="placeholder-topic">
                    <h4 class="text-xl font-bold text-gray-900 mb-2">Loading Chapters...</h4>
                    <p class="text-sm text-gray-500">Please wait while the chapter list loads.</p>
                </div>
            </div>
        </section>

        <!-- Difficulty Selection -->
        <section class="mb-10">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-lucide="zap" class="h-6 w-6 mr-3 text-red-500"></i>
                Difficulty Level
            </h3>
            <div id="difficulty-selection" class="flex flex-col sm:flex-row gap-4">
                
                <!-- Simple Button -->
                <button data-difficulty="simple" class="difficulty-btn card flex-1 flex flex-col items-center justify-center p-4 bg-white text-gray-800 border-2 border-gray-200 hover:bg-gray-100 transition-all duration-200">
                    <i data-lucide="smile" class="h-8 w-8 text-green-500 mb-1"></i>
                    <span class="text-lg font-bold">Simple</span>
                    <span id="simple-available-q" class="text-xs text-gray-500 mt-1">0 Questions</span>
                </button>

                <!-- Medium Button -->
                <button data-difficulty="medium" class="difficulty-btn card flex-1 flex flex-col items-center justify-center p-4 bg-white text-gray-800 border-2 border-gray-200 hover:bg-gray-100 transition-all duration-200">
                    <i data-lucide="brain" class="h-8 w-8 text-yellow-500 mb-1"></i>
                    <span class="text-lg font-bold">Medium</span>
                    <span id="medium-available-q" class="text-xs text-gray-500 mt-1">0 Questions</span>
                </button>

                <!-- Advanced Button -->
                <button data-difficulty="advanced" class="difficulty-btn card flex-1 flex flex-col items-center justify-center p-4 bg-white text-gray-800 border-2 border-gray-200 hover:bg-gray-100 transition-all duration-200">
                    <i data-lucide="trending-up" class="h-8 w-8 text-red-500 mb-1"></i>
                    <span class="text-lg font-bold">Advanced</span>
                    <span id="advanced-available-q" class="text-xs text-gray-500 mt-1">0 Questions</span>
                </button>

            </div>
        </section>

        <!-- Start Quiz Button -->
        <div class="mt-8 text-center">
            <p id="error-message" class="hidden text-red-600 font-semibold mb-4 text-sm">Please select both a Chapter and a Difficulty level to begin.</p>
            <button id="start-quiz-btn" disabled class="w-full sm:w-1/2 lg:w-1/3 py-3 px-6 rounded-xl bg-gray-400 text-white text-xl font-bold transition-all duration-300 cursor-not-allowed">
                Start Quiz
            </button>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-cbse-blue mt-16 py-4">
        <div class="max-w-7xl mx-auto px-4 text-center text-white">
            <small class="text-sm opacity-70">Â© 2025 Ready4Exam.</small>
        </div>
    </footer>

    <script>
        // Placeholder data for chapters. In a real app, this would come from an API.
        const chaptersData = [
            { id: 'motion', title: 'Motion', slug: 'motion', count: { simple: 10, medium: 25, advanced: 15 } },
            { id: 'gravitation', title: 'Gravitation', slug: 'gravitation', count: { simple: 10, medium: 25, advanced: 15 } },
            { id: 'work-energy-power', title: 'Work, Energy, and Power', slug: 'work-energy-power', count: { simple: 10, medium: 25, advanced: 15 } },
            { id: 'sound', title: 'Sound', slug: 'sound', count: { simple: 10, medium: 25, advanced: 15 } },
            { id: 'matter', title: 'Matter in Our Surroundings', slug: 'matter', count: { simple: 10, medium: 25, advanced: 15 } },
        ];

        let selectedTopic = null;
        let selectedDifficulty = 'medium'; // Default selection

        const chapterListEl = document.getElementById('chapter-list');
        const difficultySelectionEl = document.getElementById('difficulty-selection');
        const simpleCountEl = document.getElementById('simple-available-q');
        const mediumCountEl = document.getElementById('medium-available-q');
        const advancedCountEl = document.getElementById('advanced-available-q');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const errorMessageEl = document.getElementById('error-message');

        /** Renders the list of available chapters */
        function renderChapters() {
            chapterListEl.innerHTML = ''; // Clear the placeholder
            chaptersData.forEach(chapter => {
                const card = document.createElement('div');
                card.className = 'card chapter-card flex flex-col justify-between';
                card.dataset.topic = chapter.slug;
                card.innerHTML = `
                    <div>
                        <h4 class="text-xl font-bold text-gray-900 mb-2">${chapter.title}</h4>
                        <p class="text-sm text-gray-500">Total Questions Available: ${chapter.count.simple + chapter.count.medium + chapter.count.advanced}</p>
                    </div>
                `;
                card.addEventListener('click', (e) => handleTopicSelection(chapter.slug, e.currentTarget));
                chapterListEl.appendChild(card);
            });
        }

        /** Updates the question count display based on the currently selected topic. */
        function updateQuestionCounts() {
            const topic = chaptersData.find(c => c.slug === selectedTopic);
            if (topic) {
                simpleCountEl.textContent = `${topic.count.simple} Questions`;
                mediumCountEl.textContent = `${topic.count.medium} Questions`;
                advancedCountEl.textContent = `${topic.count.advanced} Questions`;
            } else {
                simpleCountEl.textContent = '0 Questions';
                mediumCountEl.textContent = '0 Questions';
                advancedCountEl.textContent = '0 Questions';
            }
        }

        /** Handles chapter card selection. */
        function handleTopicSelection(topicSlug, targetElement) {
            // Unselect all chapter cards
            chapterListEl.querySelectorAll('.chapter-card').forEach(card => {
                card.classList.remove('selected-chapter');
            });

            // Select the target card
            targetElement.classList.add('selected-chapter');

            selectedTopic = topicSlug;
            updateQuestionCounts();
            updateStartButtonStatus();
        }

        /** Handles difficulty button selection. */
        function handleDifficultySelection(difficulty, targetElement) {
            // Unselect all difficulty buttons
            difficultySelectionEl.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected-difficulty', 'bg-blue-600', 'text-white', 'shadow-md');
                btn.classList.add('bg-white', 'text-gray-800', 'border-2', 'border-gray-200', 'hover:bg-gray-100');
            });

            // Select the target button
            targetElement.classList.add('selected-difficulty', 'bg-blue-600', 'text-white', 'shadow-md');
            targetElement.classList.remove('bg-white', 'text-gray-800', 'border-2', 'border-gray-200', 'hover:bg-gray-100');

            selectedDifficulty = difficulty;
            
            updateStartButtonStatus();
        }

        /** Enables/Disables the Start Quiz button based on selections. */
        function updateStartButtonStatus() {
            if (selectedTopic && selectedDifficulty) {
                startQuizBtn.disabled = false;
                startQuizBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                startQuizBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                errorMessageEl.classList.add('hidden');
            } else {
                startQuizBtn.disabled = true;
                startQuizBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                startQuizBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            }
        }

        /** Redirects the user to the quiz page. */
        function handleStartQuiz() {
            if (selectedTopic && selectedDifficulty) {
                const subject = new URLSearchParams(window.location.search).get('subject') || 'Science';
                // Pass the necessary parameters to the quiz engine
                const url = `quiz-engine.html?class=9&subject=${subject}&topic=${selectedTopic}&difficulty=${selectedDifficulty}`;
                window.location.href = url;
            } else {
                errorMessageEl.classList.remove('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderChapters();
            
            // --- FIX APPLIED HERE ---
            difficultySelectionEl.querySelectorAll('.difficulty-btn').forEach(btn => {
                // We use e.currentTarget to ensure the event listener always refers to the button
                // element that the listener was attached to, even if the icon or text is clicked.
                btn.addEventListener('click', (e) => {
                    const clickedButton = e.currentTarget; 
                    handleDifficultySelection(clickedButton.dataset.difficulty, clickedButton);
                });
            });
            // --- END FIX ---


            startQuizBtn.addEventListener('click', handleStartQuiz);

            // Pre-select the 'medium' difficulty button on load
            // This ensures a default difficulty is always set.
            document.querySelector('.difficulty-btn[data-difficulty="medium"]').click();
        });
    </script>
</body>
</html>
