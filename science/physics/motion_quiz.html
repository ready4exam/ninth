<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Motion Chapter Quiz</title>
Â  Â Â 
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>Â 
Â  Â  
Â  Â  Â  Â  <script src="../../js/config.js"></script>Â 

Â  Â  <style>
Â  Â  Â  Â  /* Define a max width for the quiz container for better readability */
Â  Â  Â  Â  .quiz-container { max-width: 800px; }
Â  Â  Â  Â  /* Style for the primary button */
Â  Â  Â  Â  .btn-primary {Â 
Â  Â  Â  Â  Â  Â  background-color: #1a3e6a;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  transition: background-color 0.15s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-primary:hover {Â 
Â  Â  Â  Â  Â  Â  background-color: #1a3e6a;
Â  Â  Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  }
Â  Â  </style>

Â  Â  <script>
Â  Â  Â  Â  // Tailwind Configuration
Â  Â  Â  Â  tailwind.config = {
Â  Â  Â  Â  Â  Â  theme: {
Â  Â  Â  Â  Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: { sans: ['Inter', 'sans-serif'], },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'cbse-blue': '#1a3e6a',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'cbse-light': '#f0f4f8',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'accent-green': '#059669',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'correct': '#10b981',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'incorrect': '#ef4444',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // === START: Quiz Specific Configuration ===
Â  Â  Â  Â  const TABLE_NAME = 'motion';Â 
Â  Â  Â  Â  // === END: Quiz Specific Configuration ===

Â  Â  Â  Â  // State variables
Â  Â  Â  Â  let allQuestions = [];
Â  Â  Â  Â  let currentQuizQuestions = [];
Â  Â  Â  Â  let currentQuestionIndex = 0;
Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  let selectedDifficulty = '';

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Initializes the Supabase client and starts fetching data.
Â  Â  Â  Â  Â * NOTE: Variables are accessed via window. to match /js/config.js file structure.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function initSupabase() {
Â  Â  Â  Â  Â  Â  if (typeof window.SUPABASE_URL === 'undefined' || typeof window.SUPABASE_ANON_KEY === 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('quiz-container').innerHTML = `<p class="error-message text-red-700 bg-red-100 p-4 rounded">Configuration Error: **SUPABASE_URL** or **SUPABASE_ANON_KEY** not defined. Check **../../js/config.js** and its file path.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const supabaseClient = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  fetchQuizData(supabaseClient);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Fetches quiz data from the configured Supabase table.
Â  Â  Â  Â  Â * @param {object} supabaseClient - The initialized Supabase client.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function fetchQuizData(supabaseClient) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');

Â  Â  Â  Â  Â  Â  const { data: quizData, error } = await supabaseClient
Â  Â  Â  Â  Â  Â  Â  Â  .from(TABLE_NAME)Â 
Â  Â  Â  Â  Â  Â  Â  Â  .select('*'); // Select all columns

Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  if (container) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="error-message text-red-700 bg-red-100 p-4 rounded">Error retrieving questions: ${error.message}. Please check RLS policy for the table **${TABLE_NAME}**.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (quizData && quizData.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  allQuestions = quizData;
Â  Â  Â  Â  Â  Â  Â  Â  renderDifficultySelection(quizData);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (container) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="text-gray-700 p-4 rounded">No questions found for table **${TABLE_NAME}**.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Renders the screen allowing the user to select quiz difficulty.
Â  Â  Â  Â  Â * @param {Array} data - All fetched questions.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function renderDifficultySelection(data) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  Â  Â  const difficulties = [...new Set(data.map(q => q.difficulty))].filter(d => d); 

Â  Â  Â  Â  Â  Â  if (difficulties.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â container.innerHTML = `<p class="text-gray-700 p-4 rounded">No difficulties found in the data for table **${TABLE_NAME}**. Ensure your 'difficulty' column is populated.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let difficultyOptions = difficulties.map(d =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  `<button class="difficulty-btn btn-primary m-2" data-difficulty="${d}">${d.charAt(0).toUpperCase() + d.slice(1)} Quiz</button>`
Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center p-6 bg-white rounded-lg shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-cbse-blue">Select Difficulty for the **Motion** Quiz</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center flex-wrap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${difficultyOptions}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Attach event listeners to the new difficulty buttons
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.difficulty-btn').forEach(button => {
Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', (e) => startQuiz(e.target.dataset.difficulty));
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Filters questions by difficulty, shuffles them, and begins the quiz.
Â  Â  Â  Â  Â * @param {string} difficulty - The selected difficulty level.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function startQuiz(difficulty) {
Â  Â  Â  Â  Â  Â  selectedDifficulty = difficulty;
Â  Â  Â  Â  Â  Â  currentQuizQuestions = allQuestions.filter(q => q.difficulty && q.difficulty.toLowerCase() === difficulty.toLowerCase());
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentQuizQuestions.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`No ${difficulty} questions found.`);
Â  Â  Â  Â  Â  Â  Â  Â  renderDifficultySelection(allQuestions);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  currentQuizQuestions.sort(() => Math.random() - 0.5); // Shuffle the questions
Â  Â  Â  Â  Â  Â  currentQuestionIndex = 0;
Â  Â  Â  Â  Â  Â  score = 0;
Â  Â  Â  Â  Â  Â  renderQuestion();
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Renders the current question and its options.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function renderQuestion() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  Â  Â  if (currentQuestionIndex >= currentQuizQuestions.length) {
Â  Â  Â  Â  Â  Â  Â  Â  renderResults(); // Go to results screen
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const q = currentQuizQuestions[currentQuestionIndex];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Collect existing options
Â  Â  Â  Â  Â  Â  const options = [];
Â  Â  Â  Â  Â  Â  if (q.option_a) options.push({ key: 'A', text: q.option_a });
Â  Â  Â  Â  Â  Â  if (q.option_b) options.push({ key: 'B', text: q.option_b });
Â  Â  Â  Â  Â  Â  if (q.option_c) options.push({ key: 'C', text: q.option_c });
Â  Â  Â  Â  Â  Â  if (q.option_d) options.push({ key: 'D', text: q.option_d });

Â  Â  Â  Â  Â  Â  const optionButtons = options.map(opt => `
Â  Â  Â  Â  Â  Â  Â  Â  <button class="option-btn w-full text-left p-3 my-2 border rounded-lg bg-cbse-light hover:bg-cbse-blue/20 transition duration-100 ease-in-out focus:outline-none focus:ring-2 focus:ring-cbse-blue" data-key="${opt.key}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-cbse-blue mr-2">${opt.key}.</span> ${opt.text}
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 bg-white rounded-lg shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm font-medium mb-2 text-cbse-blue">Question ${currentQuestionIndex + 1} of ${currentQuizQuestions.length} (Difficulty: ${selectedDifficulty.toUpperCase()})</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold mb-4">${q.question_text}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${q.scenario_reason_text ? `<p class="text-sm italic mb-4 p-2 bg-gray-100 rounded">${q.scenario_reason_text}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="options-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionButtons}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="feedback-container" class="mt-4 text-center"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Attach click handler to all option buttons
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.option-btn').forEach(button => {
Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', handleAnswerClick);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Handles the user's answer selection, provides feedback, and sets up the next question button.
Â  Â  Â  Â  Â * @param {Event} event - The click event from the option button.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function handleAnswerClick(event) {
Â  Â  Â  Â  Â  Â  const selectedButton = event.target.closest('.option-btn');
Â  Â  Â  Â  Â  Â  const selectedKey = selectedButton.dataset.key;
Â  Â  Â  Â  Â  Â  const currentQuestion = currentQuizQuestions[currentQuestionIndex];
Â  Â  Â  Â  Â  Â  const correctKey = currentQuestion.correct_answer_key;
Â  Â  Â  Â  Â  Â  const feedbackContainer = document.getElementById('feedback-container');

Â  Â  Â  Â  Â  Â  // Disable all options after selection
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);

Â  Â  Â  Â  Â  Â  // Style the buttons based on the result
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.option-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  // Highlight user's choice
Â  Â  Â  Â  Â  Â  Â  Â  if (btn.dataset.key === selectedKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.style.backgroundColor = (selectedKey === correctKey) ? '#10b981' : '#ef4444'; // correct or incorrect color
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.style.color = 'white';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Highlight the correct answer if the user was wrong
Â  Â  Â  Â  Â  Â  Â  Â  if (btn.dataset.key === correctKey && selectedKey !== correctKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.style.border = '2px solid #10b981'; // Green border for correct answer
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Update score and feedback text
Â  Â  Â  Â  Â  Â  if (selectedKey === correctKey) {
Â  Â  Â  Â  Â  Â  Â  Â  score++;
Â  Â  Â  Â  Â  Â  Â  Â  feedbackContainer.innerHTML = `<p class="text-correct font-bold text-lg">Correct! âœ…</p>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  feedbackContainer.innerHTML = `<p class="text-incorrect font-bold text-lg">Incorrect. The correct answer was **${correctKey}**. âŒ</p>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Create and append the Next button
Â  Â  Â  Â  Â  Â  const nextButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  nextButton.textContent = 'Next Question';
Â  Â  Â  Â  Â  Â  nextButton.className = 'btn-primary mt-4';
Â  Â  Â  Â  Â  Â  nextButton.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  Â  Â  Â  Â  Â  renderQuestion();
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  feedbackContainer.appendChild(nextButton);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Renders the final results screen.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function renderResults() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center p-8 bg-white rounded-lg shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-cbse-blue">Quiz Complete! ğŸ†</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl mb-6">Your Score: <span class="font-extrabold text-accent-green">${score} / ${currentQuizQuestions.length}</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-8 text-gray-700">You completed the **${selectedDifficulty.toUpperCase()}** level for the Motion chapter.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary m-2" onclick="renderDifficultySelection(allQuestions)">Select New Difficulty</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary m-2 bg-gray-500 hover:bg-gray-600" onclick="window.location.href='../../science(1).html'">Back to Subjects</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Start the application when the page loads
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  Â  Â  if (container) {
Â  Â  Â  Â  Â  Â  Â  Â  // Initial loading message
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center p-6 bg-white rounded-lg shadow-xl">Loading Motion Quiz Data...</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  initSupabase();
Â  Â  Â  Â  });

Â  Â  </script>
</head>
<body class="bg-cbse-light min-h-screen flex items-center justify-center p-4 font-sans">
Â  Â  <div id="quiz-container" class="quiz-container w-full">
Â  Â  Â  Â  </div>
</body>
</html>
